                       Introduction to Monte Carlo in Finance
                                         Giovanni Della Lunga
                                WORKSHOP IN QUANTITATIVE FINANCE
                                      Bologna - May 3-4, 2018
                                       Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE      to Monte Carlo in Finance
                                                 FINANCE)                     Bologna - May 3-4, 2018 1 / 84

                                             Introduction
   Outline
                                                          3    Variance Reduction Methods
   1   Introduction                                                Antithetic Variables
          Some Basic Ideas                                         Moment Matching
          Theoretical Foundations of Monte                4 Multi Asset Path Generation
          Carlo Simulations                                        Choleski Decomposition
   2   Single Asset Path Generation                       5 Valuation of European Option with
          Definitions                                          Stochastic Volatility
          Exact Solution Advancement                               Square-Root Diffusion: the CIR
          Numerical Integration of SDE                             Model
          The Brownian Bridge                                      The Heston Model
                                       Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE      to Monte Carlo in Finance
                                                  FINANCE)                      Bologna - May 3-4, 2018 2 / 84

                                             Introduction  Some Basic Ideas
   What is Monte Carlo?
           From a quite general point of view (not a really precise one, actually)
           with the term Monte Carlo usually one means a numerical technique
           which makes use of random numbers for solving a problem.
           For the moment we assume that you can understand, at least
           intuitively, what a random number is.
           Later we will return to the definition of a random number, and, as we
           shall see, this will lead to absolutely not trivial issues.
           Let’s start immediately with some practical examples (we’ll try to give
           a more formal definition later).
                                       Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE      to Monte Carlo in Finance
                                                  FINANCE)                    Bologna - May 3-4, 2018 3 / 84

                                             Introduction  Some Basic Ideas
   What is Monte Carlo?
           Let’s consider two problems apparently very different in nature;
           The first one is of probabilistic nature: the assessment of the premium
           for an European Option on a stock that does not pay dividends;
           The second one is an issue of purely deterministic nature: the
           determination of the area enclosed by a plane figure, such as a circle.
                                       Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE      to Monte Carlo in Finance
                                                  FINANCE)                    Bologna - May 3-4, 2018 4 / 84

                                              Introduction  Some Basic Ideas
   What is Monte Carlo?
           Let’s start with the first problem. The pricing of an option is usually
           dealt with in the context of so-called risk-neutral valuation.
           Indicating with f [S(T )] where S is the value of the underlying asset,
           the value of the option at maturity T , the value today, f [S(t)], is
           given by
                                     f (S(t)) = EQ [P(t, T )f [S(T )]]
           EQ being the risk-neutral expectation value and P(t, T ) the discount
           function between t and T .
           Let’s assume, for simplicity, to know with certainty the value of the
           discount function so the problem can be put in the form
                                    f (S(t)) = e -r (T -t) EQ [f [S(T )]]
                                        Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE       to Monte Carlo in Finance
                                                   FINANCE)                    Bologna - May 3-4, 2018 5 / 84

                                             Introduction  Some Basic Ideas
   What is Monte Carlo?
           The formulation of the problem makes clear its inherently probabilistic
           nature.
           The application of the Monte Carlo method in this case is reduced
           essentially to the generation of a sufficiently high number of estimates
           of f [S(T )] from which to extract the average value.
           To this end it is necessary first to introduce a hypothesis on how the
           underlying stock price evolves over time;
                                       Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE      to Monte Carlo in Finance
                                                  FINANCE)                    Bologna - May 3-4, 2018 6 / 84

                                             Introduction  Some Basic Ideas
   What is Monte Carlo?
           Let’s suppose for example that the asset price follows a geometric
           Brownian motion, according to this hypothesis the rate of change of
           the price in a range of infinitesimal time is described by
                                            dSt = rSt dt + St sdZt
           where r is the risk free rate, s is the volatility of S returns and dw is
           a brownian motion;
           A discrete version, which can easily be simulated is given by the
           difference equation
                                                                              v
                                                                                     
                                                              1 2
                            St = St-<U+2206>t exp r - s <U+2206>t + s <U+2206>tzt
                                                              2
           for times t <U+2208> (<U+2206>t, 2<U+2206>t, . . . , T ) and zt being standard normally
           distributed random numbers;
                                       Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE      to Monte Carlo in Finance
                                                  FINANCE)                    Bologna - May 3-4, 2018 7 / 84

                                             Introduction  Some Basic Ideas
   What is Monte Carlo?
           Once we have the simulated value of the underlying at time T , we are
           able to derive the value of the option at the same date;
           Assuming for example that the option is a CALL we simply write
                                      f [S(T )] = max(S(T ) - K , 0)
           where K is the strike price.
           By repeating the above procedure a very large number of times we
           are able to obtain a distribution of values for f [S(T )] from which it is
           possible to extract the expectation value ...
                                       Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE      to Monte Carlo in Finance
                                                  FINANCE)                    Bologna - May 3-4, 2018 8 / 84

                                             Introduction  Some Basic Ideas
   What is Monte Carlo?
                                       Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE      to Monte Carlo in Finance
                                                  FINANCE)                    Bologna - May 3-4, 2018 9 / 84

                                             Introduction  Some Basic Ideas
   Interlude - Let’s code ...
                                       Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE      to Monte Carlo in Finance
                                                  FINANCE)                    Bologna - May 3-4, 2018 10 / 84

                                             Introduction  Some Basic Ideas
   Out toolbox: Jupyter, Python, R
           Python, R
           The Python world developed the IPython notebook system.
           Notebooks allow you to write text, but you insert code blocks as
           ”cells” into the notebook.
           A notebook is interactive, so you can execute the code in the cell
           directly!
           Recently the Notebook idea took a much enhanced vision and scope,
           to explicitly allow languages other than Python to run inside the cells.
           Thus the Jupyter Notebook was born, a project initially aimed at
           Julia, Python and R (Ju-Pyt-e-R). But in reality many other
           languages are supported in Jupyter.
                                       Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE      to Monte Carlo in Finance
                                                  FINANCE)                    Bologna - May 3-4, 2018 11 / 84

                                             Introduction  Some Basic Ideas
   Out toolbox: Jupyter, Python, R
                                       Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE      to Monte Carlo in Finance
                                                  FINANCE)                    Bologna - May 3-4, 2018 12 / 84

                                             Introduction  Some Basic Ideas
   Out toolbox: Jupyter, Python, R
                                       Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE      to Monte Carlo in Finance
                                                  FINANCE)                    Bologna - May 3-4, 2018 13 / 84

                                             Introduction  Some Basic Ideas
   Out toolbox: Jupyter, Python, R
           The IRKernel
           To enable support of a new language means that somebody has to
           write a ”kernel”.
           The kernel for R is called IRKernel (available at github).
           How do you use Jupyter?
           Once Jupyter is up and running, you interact with it on a web page.
                                       Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE      to Monte Carlo in Finance
                                                  FINANCE)                    Bologna - May 3-4, 2018 14 / 84

                                             Introduction  Some Basic Ideas
   Out toolbox: Jupyter, Python, R
           Benefits of using Jupyter
           Jupyter was designed to enable sharing of notebooks with other
           people. The idea is that you can write some code, mix some text with
           the code, and publish this as a notebook. In the notebook they can
           see the code as well as the actual results of running the code.
           This is a nice way of sharing little experimental snippets, but also to
           publish more detailed reports with explanations and full code sets. Of
           course, a variety of web services allows you to post just code snippets
           (e.g. gist). What makes Jupyter different is that the service will
           actually render the code output.
           One interesting benefit of using Jupyter is that Github magically
           renders notebooks. See for example, the github Notebook gallery.
                                       Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE      to Monte Carlo in Finance
                                                  FINANCE)                    Bologna - May 3-4, 2018 15 / 84

                                             Introduction  Some Basic Ideas
   Notebook
                                                                  GitHub : polyhedron-gdl;
                                                                  Notebooks : mcs 1;
                                       Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE      to Monte Carlo in Finance
                                                  FINANCE)                    Bologna - May 3-4, 2018 16 / 84

                                             Introduction  Some Basic Ideas
   What is Monte Carlo?
    Regardless the many different definitions, Montecarlo methods share a
    common procedural pattern;
       1   Define a domain of possible inputs;
       2   Generate inputs randomly from a probability distribution over the
           domain;
       3   Perform a deterministic computation on the inputs;
       4   Aggregate the results;
    This is particularly evident in the next example...
                                       Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE      to Monte Carlo in Finance
                                                  FINANCE)                    Bologna - May 3-4, 2018 17 / 84

                                             Introduction  Some Basic Ideas
   What is Monte Carlo?
                                                                  Let’s now consider the second
                                                                  problem;
                                                                  Take a circle inscribed in a unit
                                                                  square. Given that the circle
                                                                  and the square have a ratio of
                                                                  areas that is p/4, the value of p
                                                                  can be approximated using a
                                                                  Monte Carlo method:
                                       Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE      to Monte Carlo in Finance
                                                  FINANCE)                    Bologna - May 3-4, 2018 18 / 84

                                             Introduction  Some Basic Ideas
   What is Monte Carlo?
                                                             1    Draw a square on the ground,
                                                                  then inscribe a circle within it.
                                                             2    Uniformly scatter some objects
                                                                  of uniform size (grains of rice or
                                                                  sand) over the square.
                                                             3    Count the number of objects
                                                                  inside the circle and the total
                                                                  number of objects.
                                                             4    The ratio of the two counts is an
                                                                  estimate of the ratio of the two
                                                                  areas, which is p/4. Multiply
                                                                  the result by 4 to estimate p.
                                       Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE      to Monte Carlo in Finance
                                                  FINANCE)                    Bologna - May 3-4, 2018 19 / 84

                                             Introduction  Some Basic Ideas
   What is Monte Carlo?
                                                                  In this procedure the domain of
                                                                  inputs is the square that
                                                                  circumscribes our circle.
                                                                  We generate random inputs by
                                                                  scattering grains over the square
                                                                  then perform a computation on
                                                                  each input (test whether it falls
                                                                  within the circle).
                                                                  Finally, we aggregate the results
                                                                  to obtain our final result, the
                                                                  approximation of p.
                                       Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE      to Monte Carlo in Finance
                                                  FINANCE)                    Bologna - May 3-4, 2018 20 / 84

                                             Introduction  Some Basic Ideas
   What is Monte Carlo?
                                                                  There are two important points
                                                                  to consider here...
                                                                  First, if the grains are not
                                                                  uniformly distributed, then our
                                                                  approximation will be a poor
                                                                  one;
                                                                  Second, there should be a large
                                                                  number of inputs. The
                                                                  approximation is generally very
                                                                  poor if only a few grains are
                                                                  randomly dropped into the
                                                                  whole square. On average the
                                                                  approximation improves
                                                                  (slowly!) as more grains are
                                                                  dropped.
                                       Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE      to Monte Carlo in Finance
                                                  FINANCE)                     Bologna - May 3-4, 2018 21 / 84

                                             Introduction  Some Basic Ideas
   Notebook
                                                                  GitHub : polyhedron-gdl;
                                                                  Notebooks : mcs 2;
                                       Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE      to Monte Carlo in Finance
                                                  FINANCE)                    Bologna - May 3-4, 2018 22 / 84

                                             Introduction   Some Basic Ideas
   Monte Carlo is Integration!
           There is a formal connection between the use of the Monte Carlo
           method and the concept of integration of a function.
           First of all we observe how the problems discussed in the previous
           paragraph can be attributed both to the calculation of integrals.
           The case related to the area of the circle is evident
           The price of an option as we have seen is nothing more than the
           discounted value of the expectation value of the price at maturity, the
           underlying risk factor (the stock price) is distributed according to a
           log-normal distribution, therefore, we have (for the CALL case):
                                                   +8
                                                   Z
                       C (t, S) = e -r (T -t)           max[S(T ) - K ] f[S(T )] dS(T )
                                                   0
                                       Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE       to Monte Carlo in Finance
                                                  FINANCE)                     Bologna - May 3-4, 2018 23 / 84

                                             Introduction  Some Basic Ideas
   Monte Carlo is Integration!
           More in general we can state that each extraction of a sample of
           random numbers can be used as an estimator of an integral.
           As an example consider the case relating to the integration of a
           function of a real variable;
           by a suitable change of variable, we can always bring us back to the
           simplest case in which the integration interval is between 0 and 1:
                                            Z1                   Z1
                                      I =         f (x)dx =            1 · f (x)dx
                                             0                    0
                                       Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE      to Monte Carlo in Finance
                                                  FINANCE)                       Bologna - May 3-4, 2018 24 / 84

                                             Introduction   Some Basic Ideas
   Monte Carlo is Integration!
           The key point of our argument is to recognize that the expression
           written above is also the expectation value of the function f at values
           of a random variable uniformly distributed in the range [0, 1].
           It becomes possible to estimate the value of our integral using an
           arithmetic mean of n values of f (Ui ) where each Ui is a sample from
           a uniform distribution in [0, 1].
           In other words we can say that the quantity
                                                              n
                                                          1 X
                                                 I˜n =            f (Ui )
                                                          n
                                                            i=1
           is an unbiased estimator of I.
                                       Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE      to Monte Carlo in Finance
                                                  FINANCE)                    Bologna - May 3-4, 2018 25 / 84

                                             Introduction  Some Basic Ideas
   Monte Carlo is Integration!
           The variance of the estimator is
                                                     var (f (U )
                                                                             i
                                            var I˜n =
                                                                       n
           the mean square error of the estimator, which can be interpreted as
           the mean square error of the Monte Carlo simulation, decreases with
           increasing n.
           This result is completely independent of the dimensionality of the
           problem.
           It’s this last characteristic that makes attractive the Monte Carlo
           method for solving problems with a large number of dimensions.
           In this case typically the Monte Carlo method converge to the final
           value faster than the traditional numerical methods.
                                       Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE      to Monte Carlo in Finance
                                                  FINANCE)                     Bologna - May 3-4, 2018 26 / 84

                                             Introduction  Some Basic Ideas
   Pricing a Call Option
           It’s worth to recast the pricing problem into a simple integral
           formulation in order to gain some insight into the general problem;
           So let’s consider again the payoff of a simple plain vanilla option
                                                                     h                 i
                           e -rT EQ [h(ST )] = e -rT EQ h S0 e log(ST /S0 )
           By a simple application of Ito’s lemma is easy to demonstrate that
           the variable X = log(ST /S0 ) has a normal distribution with mean
           m = (r - 21 s 2 )T and variance s = s 2 T .
           So we can write
                                                 +8
                                                                                (X -m)2
                                                 Z
                                                                              -
                          C (S, t) = e -rT                          X
                                                       max[S0 e - K , 0]e 2s 2 dX
                                                -8
                                       Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE      to Monte Carlo in Finance
                                                  FINANCE)                    Bologna - May 3-4, 2018 27 / 84

                                             Introduction   Some Basic Ideas
   Pricing a Call Option
           It is possible to generate a normally distributed random variable
           X = F-1 (U; (r - 21 s 2 )T ; s 2 T ) using the inverse transform method,
           where F-1 (. . . ) is the inverse of the normal cumulative distribution
           function evaluated at U;
           U is a uniform [0, 1] random variable.
               U = F[X ; m, u],       u <U+2192> 1 when X <U+2192> +8,                        u <U+2192> 0 when X <U+2192> -8
           From the previous relation we find (within a normalization factor)
                                     dF[X ; m, u]                                  1
                             du =                         dX <U+21D2> dX =               (X -m)2
                                                                                           du
                                            dX                                  -
                                                                              e      2s 2
           and ...
                                       Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE      to Monte Carlo in Finance
                                                  FINANCE)                         Bologna - May 3-4, 2018 28 / 84

                                             Introduction  Some Basic Ideas
   Pricing a Call Option
           ... finally we can write our integral in the form
                                                              Z1
                                              C (S, t) =           f (u)du
                                                              0
           where f (u) = e -rT max[S0 exp(F-1 (u; m, s)) - K , 0]
                                       Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE      to Monte Carlo in Finance
                                                  FINANCE)                    Bologna - May 3-4, 2018 29 / 84

                                              Introduction  Some Basic Ideas
   Pricing a Call Option - The Python Code
    def f ( u , S0 ,          K, r , sigma , T ) :
             m            =   ( r - . 5 * s i g m a * s i g m a ) *T
              s           =   s i g m a * s q r t (T)
              f u         =   exp (- r *T) *
                              np . maximum ( S0* exp ( scnorm . p p f ( u , m, s ))-K, 0 )
              return f u
    u               = rand (1000000)
    f u             = f ( u , S0 , K, r , sigma , T)
    p r i n t mean ( f u )
                                        Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE       to Monte Carlo in Finance
                                                   FINANCE)                    Bologna - May 3-4, 2018 30 / 84

                                             Introduction  Some Basic Ideas
   Pricing a Call Option - The Integrand Function
                                       Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE      to Monte Carlo in Finance
                                                  FINANCE)                    Bologna - May 3-4, 2018 31 / 84

                                             Introduction  Some Basic Ideas
   Notebook
                                                                  GitHub : polyhedron-gdl;
                                                                  Notebooks : mcs 3;
                                       Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE      to Monte Carlo in Finance
                                                  FINANCE)                    Bologna - May 3-4, 2018 32 / 84

                                             Introduction  Theoretical Foundations of Monte Carlo Simulations
    Feynman–Kac formula
           The Feynman–Kac formula named after Richard Feynman and
           Mark Kac, establishes a link between parabolic partial differential
           equations (PDEs) and stochastic processes.
           It offers a method of solving certain PDEs by simulating random paths
           of a stochastic process. Conversely, an important class of expectations
           of random processes can be computed by deterministic methods.
           Consider the PDE
                                                               2
            <U+2202>u                   <U+2202>u              1 2         <U+2202>   u
                 (x, t)+µ(x, t) (x, t)+ 2 s (x, t) 2 (x, t)-V (x, t)u(x, t)+f (x, t) = 0
            <U+2202>t                   <U+2202>x                          <U+2202>x
           subject to the terminal condition
                                                  u(x, T ) = <U+03C8>(x)
                                       Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE      to Monte Carlo in Finance
                                                  FINANCE)                          Bologna - May 3-4, 2018   33 / 84

                                              Introduction    Theoretical Foundations of Monte Carlo Simulations
    Feynman–Kac formula
           Then the Feynman–Kac formula tells us that the solution can be
           written as a conditional expectation
                              "Z                                                                                 #
                                   T    Rr                                      RT
                u(x, t) = E Q        e-  t  V (Xt ,t ) dt
                                                          f (Xr , r )dr + e -    t V (Xt ,t ) dt
                                                                                                 <U+03C8>(XT ) Xt = x
                                 t
           under the probability measure Q such that X ’ is an Ito process driven
           by the equation
                                     dX = µ(X , t) dt + s(X , t) dW Q
                                        Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE        to Monte Carlo in Finance
                                                   FINANCE)                            Bologna - May 3-4, 2018   34 / 84

                                             Introduction  Theoretical Foundations of Monte Carlo Simulations
   Valuing a derivative contract
           A derivative can be perfectly replicated by means of a self-financing
           dynamic portfolio whose value exactly matches all of the derivative
           flows in every state of the world. This approach shows that the values
           of the derivative (and of the portofolio) solves the following PDE
                                      <U+2202>f         <U+2202>f           1 <U+2202>f 2 2
                                            +         rS +            s S = fr                                (1)
                                      <U+2202>t         <U+2202>S           2 <U+2202>S
           with the terminal condition at T that is the derivative’s payoff
                                             f (T , S(T )) = payoff
                                       Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE      to Monte Carlo in Finance
                                                  FINANCE)                          Bologna - May 3-4, 2018   35 / 84

                                             Introduction  Theoretical Foundations of Monte Carlo Simulations
   Valuing a derivative contract
           According to the Feynmann-Kac formula, if f (t0 , S(t0 )) solves the
           B-S PDE, then it is also solution of
                                                       h                                      i
                             f (t0 , S(t0 )) = E e -r (T -t0 ) f (T , S(T )|Ft0
           i.e. it’s the expected value of the discounted payoff in a probability
           measure where the evolution of the asset is
                                               dS = rSdt + sSdw
           This probability measure is the Risk Neutral Measure
                                       Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE      to Monte Carlo in Finance
                                                  FINANCE)                          Bologna - May 3-4, 2018   36 / 84

                                             Introduction  Theoretical Foundations of Monte Carlo Simulations
   Valuing a derivative contract
           Since there exist such an equivalence, we can compute option prices
           by means of two numerical methods
           PDE: finite difference (explicit, implicit, crank-nicholson)suitable for
           optimal exercise derivatives;
           Integration
                   Quadrature Methods;
                   Monte Carlo Methods
                                       Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE      to Monte Carlo in Finance
                                                  FINANCE)                          Bologna - May 3-4, 2018   37 / 84

                              Single Asset Path Generation
   Outline
                                                            3    Variance Reduction Methods
   1   Introduction                                                  Antithetic Variables
          Some Basic Ideas                                           Moment Matching
          Theoretical Foundations of Monte                  4 Multi Asset Path Generation
          Carlo Simulations                                          Choleski Decomposition
   2   Single Asset Path Generation                         5 Valuation of European Option with
          Definitions                                            Stochastic Volatility
          Exact Solution Advancement                                 Square-Root Diffusion: the CIR
          Numerical Integration of SDE                               Model
          The Brownian Bridge                                        The Heston Model
                                         Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE        to Monte Carlo in Finance
                                                   FINANCE)                       Bologna - May 3-4, 2018 38 / 84

                              Single Asset Path Generation   Definitions
   Scenario Contruction
           There are several ways to construct scenario for pricing
           Constructing a path of the solution to the SDE at times ti by exact
           advancement of the solution;
                   This method is only possible if we have an analytical expression for the
                   solution of the stochastic differential equation
           Approximate numerical solution of the stochastic differential
           equation;
                   This is the method of choice if we cannot use the previous one; Just as
                   in the case of ODE there are numerical techniques for discretizing and
                   solving SDE.
                                         Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE        to Monte Carlo in Finance
                                                   FINANCE)                     Bologna - May 3-4, 2018 39 / 84

                              Single Asset Path Generation   Exact Solution Advancement
   Exact Solution Advancement
           Example: Log-normal process with constant drift and volatility
                                                         dS
                                           SDE <U+21D2>              = µdt + sdw
                                                          S
                                                                   (µ- 12 s 2 )(T -t0 )+s[w (T )-w (t0 )]
                      SOLUTION <U+21D2> S(T ) = S(t0 )e
           How to obtain a sequence of Wiener process?
                                                          p
                           w (ti ) = w (ti-1 ) + ti - ti-1 Z                     Z ~ N(0, 1)
                                         Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE        to Monte Carlo in Finance
                                                   FINANCE)                          Bologna - May 3-4, 2018 40 / 84

                               Single Asset Path Generation   Exact Solution Advancement
   Exact Solution Advancement
           Defining the outcomes of successive drawings of the random variable
           Z corresponding to the j - th trajectory by Zij , we get the following
           recursive expression for the j - th trajectory of S(t):
                                                                                                          
                                                            1 2
                 S (ti ) = S (ti-1 )exp µ - s (ti - ti-1 ) + s ti - ti-1 Zij
                   j         j
                                                                                          p
                                                            2
                                          Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE         to Monte Carlo in Finance
                                                    FINANCE)                         Bologna - May 3-4, 2018  41 / 84

                              Single Asset Path Generation   Numerical Integration of SDE
   Numerical Integration of SDE
           The numerical integration of the SDE by finite difference is another
           way of generating scenarios for pricing;
           In the case of the numerical integration of ordinary differential
           equations by finite differences the numerical scheme introduces a
           discretization error that translates into the numerical solution
           differing from the exact solution by an amount proportional to a
           power of the time step.
           This amount is the truncation error of the numerical scheme.
                                         Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE        to Monte Carlo in Finance
                                                   FINANCE)                            Bologna - May 3-4, 2018 42 / 84

                              Single Asset Path Generation   Numerical Integration of SDE
   Numerical Integration of SDE
           In the case of the numerical integration of SDE by finite differences
           the interpretation of the numerical error introduced by the
           discretization scheme is more complicated;
           Unlike the case of ODE where the only thing we are interested in
           computing is the solution itself, when dealing with SDE there are two
           aspects that interest us:
                   One aspect is the accuracy with which we compute the trajectories or
                   paths of a realization of the solution
                   The other aspect is the accuracy with which we compute functions of
                   the process such as expectations and moments.
                                         Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE        to Monte Carlo in Finance
                                                   FINANCE)                            Bologna - May 3-4, 2018 43 / 84

                              Single Asset Path Generation   Numerical Integration of SDE
   Numerical Integration of SDE
           The order of accuracy with which a given scheme can approximate
           trajectories of the solution is not the same as the accuracy with which
           the same scheme can approximate expectations and moments of
           functions of the trajectories;
           The convergence of the numerically computed trajectories to the
           exact trajectories is called strong convergence and the order of the
           corresponding numerical scheme is called order of strong convergence;
           The convergence of numerically computed functions of the stochastic
           process to the exact values is called weak convergence and the related
           order is called order of weak convergence.
                                         Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE        to Monte Carlo in Finance
                                                   FINANCE)                            Bologna - May 3-4, 2018 44 / 84

                              Single Asset Path Generation   Numerical Integration of SDE
   Numerical Integration of SDE
           We assume that the stock price St is driven by the stochastic
           differential equation (SDE)
                                     dS(t) = µ(S, t)dt + s(S, t)dWt                                            (2)
           where Wt is, as usual, Brownian motion.
           We simulate St over the time interval [0; T ], which we assume to be
           is discretized as 0 = t1 < t2 < · · · < tm = T , where the time
           increments are equally spaced with width dt.
           Equally-spaced time increments is primarily used for notational
           convenience, because it allows us to write ti - ti-1 as simply dt. All
           the results derived with equally-spaced increments are easily
           generalized to unequal spacing.
                                         Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE        to Monte Carlo in Finance
                                                   FINANCE)                            Bologna - May 3-4, 2018 45 / 84

                              Single Asset Path Generation   Numerical Integration of SDE
   Numerical Integration of SDE
           Euler Scheme
           The simplest way to discretize the process in Equation (2) is to use
           Euler discretization
           EULER <U+21D2> S^(ti+1 ) = S^(ti )+µ[S^(ti ), ti ]<U+2206>t+s[S^(ti ), ti ] (w (ti+1 ) - w (ti ))
           Milshstein Scheme
                                                   1              <U+2202>s[S^(ti )] h                                        i
           MILSHSTEIN <U+21D2> EULER+ s[S^(ti )]                                           (w (ti+1 ) - w (ti ))2 - <U+2206>t
                                                   2                    <U+2202>S
           This scheme is described in Glasserman and in Kloeden and Platen for general
           processes, and in Kahl and Jackel for stochastic volatility models. The scheme
           works for SDEs for which the coefficients µ(St ) and s(St ) depend only on S, and
           do not depend on t directly
                                         Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE        to Monte Carlo in Finance
                                                   FINANCE)                            Bologna - May 3-4, 2018 46 / 84

                              Single Asset Path Generation   Numerical Integration of SDE
   Numerical Integration of SDE
           For an intuitive derivation, we will only look at GBM:
                                                                     
                                                               1 2
                                     d ln xt = µ - s dt + sdWt
                                                               2
           The solution to the GBM SDE is
                                             <U+F8F1> t+<U+2206>t                                   t+<U+2206>t
                                                                                                       <U+F8FC>
                                             <U+F8F2> Z                                     Z
                                                                   1 2                                 <U+F8FD>
                        xt+<U+2206>t = xt exp                     µ - s dt +                        sdWu
                                             <U+F8F3>                     2                                   <U+F8FE>
                                                   t                                    t
                                                                                                      
                                                    1 2                            1 2
                        ~ xt 1 + µ<U+2206>t - s <U+2206>t + s<U+2206>Wt + s (<U+2206>Wt )2
                                                    2                              2
                                                                         1          <U+2202>b(xt )
           <U+21D2> xt+<U+2206>t       ~ xt + a(xt )<U+2206>t + b(xt )<U+2206>wt + b(xt )                                  ((<U+2206>Wt )2 - <U+2206>t)
                                                                         2             <U+2202>xt
                                         Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE        to Monte Carlo in Finance
                                                   FINANCE)                            Bologna - May 3-4, 2018 47 / 84

                              Single Asset Path Generation   Numerical Integration of SDE
   Notebook
                                                                    GitHub : polyhedron-gdl;
                                                                    Notebooks :
                                                                    mcs sde solution;
                                                                    Code : mcs sde solution.py;
                                         Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE        to Monte Carlo in Finance
                                                   FINANCE)                            Bologna - May 3-4, 2018 48 / 84

                              Single Asset Path Generation   The Brownian Bridge
   The Brownian Bridge
           Assume you have a Wiener process defined by a set of time-indexed
           random variables W (t1 ), W (t2 ), ..., W (tn ).
           How do you insert a random variable W (tk ) where ti = tk = ti+1 into
           the set in such a manner that the resulting set still constitutes a
           Wiener process?
           The answer is: with a Brownian Bridge!
           The Brownian Bridge is a sort of interpolation that allows you to
           introduce intermediate points in the trajectory of a Wiener process.
                                         Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE        to Monte Carlo in Finance
                                                   FINANCE)                      Bologna - May 3-4, 2018 49 / 84

                              Single Asset Path Generation   The Brownian Bridge
   The Brownian Bridge
           Brownian Bridge Construction
           Given W (t) and W (t + dt1 + dt2 ) we want to find W (t + dt1 );
           We assume that we can get the middle point by a weighted average
           of the two end points plus an independent normal random variable:
                         W (t + dt1 ) = aW (t) + ßW (t + dt1 + dt2 ) + <U+03B3>Z
           where a, ß and <U+03BB> are constants to be determined and Z is a standard
           normal random variable.
                                         Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE        to Monte Carlo in Finance
                                                   FINANCE)                      Bologna - May 3-4, 2018 50 / 84

                              Single Asset Path Generation   The Brownian Bridge
   The Brownian Bridge
           We have to satisfy the following conditions:
                            <U+F8F1>
                            <U+F8F2>cov [W (t + <U+2206>t1 ), W (t)] = min(t + <U+2206>t1 , t) = t
                            <U+F8F4>
                              cov [W (t + <U+2206>t1 ), W (t + <U+2206>t1 + <U+2206>t2 )] = t + <U+2206>t1
                            <U+F8F4>
                              var [W (t + <U+2206>t1 )] = t + <U+2206>t1
                            <U+F8F3>
                            <U+F8F1>
                            <U+F8F2>a + ß = 1
                            <U+F8F4>
                              at + ß(t + <U+2206>t1 + <U+2206>t2 ) = t + <U+2206>t1
                            <U+F8F4>
                            <U+F8F3> 2
                              a t + 2aßt + ß 2 (t + <U+2206>t1 + <U+2206>t2 ) + <U+03BB>2 = t + <U+2206>t1
           which are equivalent to:
                                              <U+F8F1>            <U+2206>t2
                                              <U+F8F4>
                                              <U+F8F2>  a  =   <U+2206>t1 +<U+2206>t2
                                                                       <U+2206>t1
                                                 ß =1-a=            <U+2206>t1 +<U+2206>t2
                                              <U+F8F4>         v
                                                 <U+03B3> = <U+2206>t1 a
                                              <U+F8F3>
                                         Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE        to Monte Carlo in Finance
                                                   FINANCE)                      Bologna - May 3-4, 2018 51 / 84

                              Single Asset Path Generation   The Brownian Bridge
   The Brownian Bridge
           We can use the brownian bridge to generate a Wiener path and then
           use the Wiener path to produce a trajectory of the process we are
           interested in;
           The simplest strategy for generating a Wiener path using the
           brownian bridge is to divide the time span of the trajectory into two
           equal parts and apply the brownian bridge construction to the middle
           point. We then repeat the procedure for the left and right sides of the
           time interval.
                                         Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE        to Monte Carlo in Finance
                                                   FINANCE)                      Bologna - May 3-4, 2018 52 / 84

                              Single Asset Path Generation   The Brownian Bridge
   The Brownian Bridge
           Notice that as we fill in the Wiener path, the additional variance of
           the normal components we add has decreasing value;
           Of course the total variance of all the Wiener increments does not
           depend on how we construct the path, however the fact that in the
           brownian bridge approach we use random variables that are multiplied
           by a factor of decreasing magnitude means that the importance of
           those variables also decreases as we fill in the path;
           The dimension of the random variables with larger variance need to
           be sampled more efficiently than the dimension with smaller variance;
                                         Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE        to Monte Carlo in Finance
                                                   FINANCE)                      Bologna - May 3-4, 2018 53 / 84

                              Single Asset Path Generation   The Brownian Bridge
   Notebook
                                                                    GitHub : polyhedron-gdl;
                                                                    Code :
                                                                    mcs brownian bridge.py;
                                         Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE        to Monte Carlo in Finance
                                                   FINANCE)                      Bologna - May 3-4, 2018 54 / 84

                               Variance Reduction Methods
   Outline
                                                            3    Variance Reduction Methods
   1   Introduction                                                  Antithetic Variables
          Some Basic Ideas                                           Moment Matching
          Theoretical Foundations of Monte                  4 Multi Asset Path Generation
          Carlo Simulations                                          Choleski Decomposition
   2   Single Asset Path Generation                         5 Valuation of European Option with
          Definitions                                            Stochastic Volatility
          Exact Solution Advancement                                 Square-Root Diffusion: the CIR
          Numerical Integration of SDE                               Model
          The Brownian Bridge                                        The Heston Model
                                         Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE        to Monte Carlo in Finance
                                                   FINANCE)                       Bologna - May 3-4, 2018 55 / 84

                               Variance Reduction Methods
   Variance Reduction Methods
           In this section we briefly discuss techniques for improving on the
           speed and efficiency of a simulazion, usually called variance reduction
           techniques;
           If we do nothing about efficiency, the number of MC replications we
           need to achieve acceptable pricing acccuracy may be surprisingly large;
           As a result in many cases variance reduction techiques are a practical
           requirement;
           From a general point of view these methods are based on two
           principal strategies for reducing variance:
                   Taking advantage of tractable features of a model to adjust or correct
                   simulation output
                   Reducing the variability in simulation input
                                         Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE        to Monte Carlo in Finance
                                                   FINANCE)                     Bologna - May 3-4, 2018 56 / 84

                               Variance Reduction Methods
   Variance Reduction Methods
           From the first section we remember that the variance of the estimator
           is                                         var (f (U )
                                                                               i
                                              var I˜n =
                                                                         n
           So, the standard error of the sample mean is the standard deviation or
                                                                      sf
                                                    SE I˜n = v
                                                                          n
           where sf2 = var (f (Ui )
                                         Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE        to Monte Carlo in Finance
                                                   FINANCE)                      Bologna - May 3-4, 2018 57 / 84

                               Variance Reduction Methods
   Variance Reduction Methods
           The most commonly used strategies for variance reduction are the
           following:
                   Antithetic variates
                   Moment Matching
                   Control variates
                   Stratified Sampling
                   Importance Sampling
                   Low-discrepancy sequences
                                         Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE        to Monte Carlo in Finance
                                                   FINANCE)                     Bologna - May 3-4, 2018 58 / 84

                               Variance Reduction Methods    Antithetic Variables
   Variance Reduction Methods - Antithetic Variates
           In this case we construc the estimator by using two brownian
           trajectories that are mirror images of each other;
           This causes cancellation of dispersion;
           This method tends to reduce the variance modestly but it is
           extremely easy to implement and as a result very commonly used;
           For the antithetic method to work we need V + and V - to be
           negatively correlated;
           this will happen if the payoff function is a monotonic function of Z ;
                                         Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE        to Monte Carlo in Finance
                                                   FINANCE)                       Bologna - May 3-4, 2018 59 / 84

                               Variance Reduction Methods    Antithetic Variables
   Variance Reduction Methods - Antithetic Variates
           To apply the antithetic variate technique, we generate standard
           normal random numbers Z and define two set of samples of the
           undelying price
                                                    v                                            v
                                 (r -s 2 /2)T +s T Z                            (r -s 2 /2)T +s T (-Z )
                      ST+ = S0 e                               ST-    = S0 e
           Similarly we define two sets of discounted payoff samples ...
                       VT+ = max[S + (T ) - K , 0] VT- = max[S - (T ) - K , 0]
           ... and at last we construct our mean estimator by averaging these
           samples
                                                         n
                                                    1X1 +                          
                                          V¯0 =                    Vj + Vj-
                                                    n        2
                                                        j=1
                                         Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE        to Monte Carlo in Finance
                                                   FINANCE)                           Bologna - May 3-4, 2018 60 / 84

                               Variance Reduction Methods    Moment Matching
   Variance Reduction Methods - Moment Matching
           Let zi , i = 1, ..., n, denote an independent standard normal random
           vector used to drive a simulation.
           The sample moments will not exactly match those of the standard
           normal. The idea of moment matching is to transform the zi to
           match a finite number of the moments of the underlying population.
           For example, the first and second moment of the normal random
           number can be matched by defining
                                                          sz
                                     z˜i = (zi - z~) + µz , i = 1, .....n                               (3)
                                                          sz
           where z~ is the sample mean of the zi and sz is the population
           standard deviation, sz is the sample standard deviation of zi , and µz s
           the population mean.
                                         Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE        to Monte Carlo in Finance
                                                   FINANCE)                     Bologna - May 3-4, 2018 61 / 84

                               Variance Reduction Methods    Moment Matching
   Notebook
                                                                    GitHub : polyhedron-gdl;
                                                                    Notebook : n03 mcs;
                                         Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE        to Monte Carlo in Finance
                                                   FINANCE)                     Bologna - May 3-4, 2018 62 / 84

                               Multi Asset Path Generation
   Outline
                                                            3    Variance Reduction Methods
   1   Introduction                                                  Antithetic Variables
          Some Basic Ideas                                           Moment Matching
          Theoretical Foundations of Monte                  4 Multi Asset Path Generation
          Carlo Simulations                                          Choleski Decomposition
   2   Single Asset Path Generation                         5 Valuation of European Option with
          Definitions                                            Stochastic Volatility
          Exact Solution Advancement                                 Square-Root Diffusion: the CIR
          Numerical Integration of SDE                               Model
          The Brownian Bridge                                        The Heston Model
                                         Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE        to Monte Carlo in Finance
                                                   FINANCE)                       Bologna - May 3-4, 2018 63 / 84

                               Multi Asset Path Generation   Choleski Decomposition
   Choleski Decomposition
           The Choleski Decomposition makes an appearance in Monte Carlo
           Methods where it is used to simulate systems with correlated
           variables.
           Cholesky decomposition is applied to the correlation matrix, providing
           a lower triangular matrix A, which when applied to a vector of
           uncorrelated samples, u, produces the covariance vector of the
           system. Thus it is highly relevant for quantitative trading.
           The standard procedure for generating a set of correlated normal
           random variables is through a linear combination of uncorrelated
           normal random variables;
           Assume we have a set of n independent standard normal random
           variables Z and we want to build a set of n correlated standard
           normals Z 0 with correlation matrix S
                                             Z 0 = AZ ,              AAt = S
                                         Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE        to Monte Carlo in Finance
                                                   FINANCE)                         Bologna - May 3-4, 2018 64 / 84

                               Multi Asset Path Generation    Choleski Decomposition
   Choleski Decomposition
           We can find a solution for A in the                   form of a triangular matrix
                                            <U+F8EB>                                   <U+F8F6>
                                               A11 0              ...        0
                                            <U+F8EC>A21 A22              ...        0 <U+F8F7>
                                            <U+F8EC>                                   <U+F8F7>
                                            <U+F8EC> ..           ..     ..            <U+F8F7>
                                            <U+F8ED> .             .         . ...<U+F8F8>
                                               An1 An2            ...      Ann
           diagonal elements                             v
                                                         u
                                                         u            Xi-1
                                               aii = tSii -                   2
                                                                            aik
                                                                      k=1
           off-diagonal elements
                                                                    i-1
                                                                                   !
                                                    1               X
                                         aij =             Sij -           aik ajk
                                                   aii
                                                                    k=1
                                         Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE        to Monte Carlo in Finance
                                                   FINANCE)                          Bologna - May 3-4, 2018 65 / 84

                               Multi Asset Path Generation   Choleski Decomposition
   Choleski Decomposition
           For example, for a two-dimension random vector we have simply
                                                                               
                                                       s1               0
                                           A=                      p
                                                      s2 <U+03C1> s2 1 - <U+03C1>2
           say one needs to generate two correlated normal variables x1 and x2
           All one needs to do is to generate two uncorrelated Gaussian random
           variables z1 and z2 and set
                                                          x1 = z1
                                                                p
                                              x2 = <U+03C1>z1 + 1 - <U+03C1>2 z2
                                         Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE        to Monte Carlo in Finance
                                                   FINANCE)                         Bologna - May 3-4, 2018 66 / 84

                               Multi Asset Path Generation   Choleski Decomposition
   Notebook
                                                                    GitHub : polyhedron-gdl;
                                                                    Notebook :
                                                                    n05 mcs multi asset path;
                                         Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE        to Monte Carlo in Finance
                                                   FINANCE)                         Bologna - May 3-4, 2018 67 / 84

         Valuation of European Option with Stochastic Volatility
   Outline
                                                                 3   Variance Reduction Methods
   1   Introduction                                                      Antithetic Variables
          Some Basic Ideas                                               Moment Matching
          Theoretical Foundations of Monte                       4 Multi Asset Path Generation
          Carlo Simulations                                              Choleski Decomposition
   2   Single Asset Path Generation                              5 Valuation of European Option with
          Definitions                                                Stochastic Volatility
          Exact Solution Advancement                                     Square-Root Diffusion: the CIR
          Numerical Integration of SDE                                   Model
          The Brownian Bridge                                            The Heston Model
                                             Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE            to Monte Carlo in Finance
                                                       FINANCE)                       Bologna - May 3-4, 2018 68 / 84

         Valuation of European Option with Stochastic Volatility Square-Root Diffusion: the CIR Model
   CIR Model
           In this section, we consider the stochastic short rate model MCIR85
           of Cox- Ingersoll-Ross which is given by the SDE:
                                                                                  v
                                          drt = <U+03BA>r (<U+03B8>r - rt )dt + sr rt dZt                                       (4)
           To simulate the short rate model, it has to be discretized. To this
           end, we divide the given time interval [0, T ] in equidistant
           sub-intervals of length t such that now t <U+2208> {0, <U+2206>t, 2<U+2206>t, . . . , T }, i.e.
           there are M + 1 points in time with M = T /t.
           The exact transition law of the square-root diffusion is known.
           Consider the general square- root diffusion process
                                                                                v
                                           dxt = <U+03BA>(<U+03B8> - xt )dt + s xt dZt                                          (5)
                                             Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE            to Monte Carlo in Finance
                                                       FINANCE)                           Bologna - May 3-4, 2018 69 / 84

         Valuation of European Option with Stochastic Volatility   Square-Root Diffusion: the CIR Model
   CIR Model
           It can be show that xt , given xs with s = t - <U+2206>t, is distributed
           according to
                                           2           -<U+03BA><U+2206>t                         -<U+03BA><U+2206>t
                                                                                                     
                                        s (1 - e                 ) 02            4
                               xt =                               <U+03C7>d        2            -<U+03BA><U+2206>t
                                                                                                   xs
                                                  4<U+03BA>                      s (1 - e               )
           where <U+03C7>02    d denotes a non-central chi-squared random variable with
                                                                     4<U+03B8><U+03BA>
                                                              d= 2
                                                                      s
           degrees of freedom and non-centrality parameter
                                                                  4-<U+03BA><U+2206>t
                                                   l= 2                  -<U+03BA><U+2206>t
                                                                                   xs
                                                          s (1 - e              )
                                             Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE            to Monte Carlo in Finance
                                                       FINANCE)                             Bologna - May 3-4, 2018 70 / 84

         Valuation of European Option with Stochastic Volatility  Square-Root Diffusion: the CIR Model
   CIR Model
           For implementation purposes, it may be convenient to sample a
           chi-squared random variable <U+03C7>2d instead of a non-central chi-squared
           one, <U+03C7>02   d.
           If d > 1, the following relationship holds true
                                                 02
                                                                    v 2
                                              <U+03C7>d (l) = (z + l) + <U+03C7>2d-1
           where z is an independent standard normally distributed random
           variable.
           Similarly, if d = 1, one has
                                                        <U+03C7>02
                                                          d   (l) =  <U+03C7>  2
                                                                        d+2N
           where N is now a Poisson-distributed random variable with intensity
           l/2. For an algorithmic representation of this simulation scheme refer
           to Glasserman, p. 124.
                                             Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE            to Monte Carlo in Finance
                                                       FINANCE)                            Bologna - May 3-4, 2018 71 / 84

         Valuation of European Option with Stochastic Volatility   Square-Root Diffusion: the CIR Model
   CIR Model: Pricing ZCB
           A MC estimator for the value of the ZCB at t is derived as follows.
           Consider a certain path i of the I simulated paths for the short rate
           process with time grid t <U+2208> {0, <U+2206>t, 2<U+2206>t, . . . , T }.
           We discount the terminal value of the ZCB, i.e. 1, step-by-step
           backward. For t < T and s = t - <U+2206>t we have
                                                                        - rt +rs <U+2206>t
                                                    Bs,i = Bt,i e            2
           The MC estimator of the ZCB value at t is
                                                                         I
                                                                    1X
                                                      BtMC       =           Bt,i
                                                                    I
                                                                       i=1
                                             Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE            to Monte Carlo in Finance
                                                       FINANCE)                             Bologna - May 3-4, 2018 72 / 84

         Valuation of European Option with Stochastic Volatility  Square-Root Diffusion: the CIR Model
   CIR Model: Pricing ZCB
           The present value of the ZCB in the CIR model takes the form:
                                                B0 (T ) = b1 (T )e -b2 (T )r0
           where
                                                                                            2<U+03BA>r2<U+03B8>r
                                                       2<U+03B3> exp((<U+03BA>r + <U+03B3>)T /2)                     sr
                                  b1 (T ) =
                                                    2<U+03B3> + (<U+03BA>r + <U+03B3>)(e <U+03B3>T - 1)
                                                                   2(e <U+03B3>T - 1)
                                        b2 (T ) =
                                                        2<U+03B3> + (<U+03BA>r + <U+03B3>)(e <U+03B3>T - 1)
                                                                 q
                                                       <U+03B3> = <U+03BA>2r + 2sr2
                                             Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE            to Monte Carlo in Finance
                                                       FINANCE)                            Bologna - May 3-4, 2018 73 / 84

         Valuation of European Option with Stochastic Volatility Square-Root Diffusion: the CIR Model
   Notebook
                                                                        GitHub : polyhedron-gdl;
                                                                        Notebook : n06 mcs cir;
                                             Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE            to Monte Carlo in Finance
                                                       FINANCE)                           Bologna - May 3-4, 2018 74 / 84

         Valuation of European Option with Stochastic Volatility The Heston Model
   The Heston Model
           Stochastic volatility models are those in which the variance of a
           stochastic process is itself randomly distributed.
           The models assumes that the underlying security’s volatility is a
           random process, governed by state variables such as the price level of
           the underlying security, the tendency of volatility to revert to some
           long-run mean value, and the variance of the volatility process itself,
           among others.
           Stochastic volatility models are one approach to resolve a
           shortcoming of the Black–Scholes model.
           In particular this model cannot explain long-observed features of the
           implied volatility surface such as volatility smile and skew, which
           indicate that implied volatility does tend to vary with respect to strike
           price and expiry.
                                             Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE            to Monte Carlo in Finance
                                                       FINANCE)                     Bologna - May 3-4, 2018 75 / 84

         Valuation of European Option with Stochastic Volatility The Heston Model
   The Heston Model
    By assuming that the volatility of the underlying price is a stochastic
    process rather than a constant, it becomes possible to model derivatives
    more accurately.
           Heston model
           CEV model
           SABR volatility model
           GARCH model
                                             Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE            to Monte Carlo in Finance
                                                       FINANCE)                     Bologna - May 3-4, 2018 76 / 84

         Valuation of European Option with Stochastic Volatility The Heston Model
   The Heston Model
           In this section we are going to consider the stochastic volatility model
           MH93 with constant short rate.
           This section values European call and put options in this model by
           MCS.
           As for the ZCB values, we also have available a semi-analytical pricing
           formula which generates natural benchmark values against which to
           compare the MCS estimates.
                                             Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE            to Monte Carlo in Finance
                                                       FINANCE)                     Bologna - May 3-4, 2018 77 / 84

         Valuation of European Option with Stochastic Volatility The Heston Model
   The Heston Model
           The basic Heston model assumes that St , the price of the asset, is
           determined by a stochastic process:
                                                                       v
                                             dSt = µSt dt +                <U+03BD>t St dWtS
           where <U+03BD>t , the instantaneous variance, is a CIR process:
                                                                               v
                                         d<U+03BD>t = <U+03BA>(<U+03B8> - <U+03BD>t ) dt + <U+03BE> <U+03BD>t dWt<U+03BD>
           and dWtS , dWt<U+03BD> are Wiener process with correlation <U+03C1>, or equivalently,
           with covariance <U+03C1>dt.
                                             Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE            to Monte Carlo in Finance
                                                       FINANCE)                       Bologna - May 3-4, 2018 78 / 84

         Valuation of European Option with Stochastic Volatility The Heston Model
   The Heston Model
    The parameters in the above equations represent the following:
           µ is the rate of return of the asset.
           <U+03B8> is the long variance, or long run average price variance; as t tends
           to infinity, the expected value of <U+03BD>t tends to <U+03B8>.
           <U+03BA> is the rate at which <U+03BD>t reverts to <U+03B8>.
           <U+03BE> is the volatility of the volatility, or vol of vol, and determines the
           variance of <U+03BD>t .
    If the parameters obey the following condition (known as the Feller
    condition) then the process <U+03BD>t is strictly positive
                                                        2<U+03BA><U+03B8> > <U+03BE> 2
                                             Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE            to Monte Carlo in Finance
                                                       FINANCE)                     Bologna - May 3-4, 2018 79 / 84

         Valuation of European Option with Stochastic Volatility The Heston Model
   The Heston Model
           The correlation introduces a new problem dimension into the
           discretization for simulation purposes.
           To avoid problems arising from correlating normally distributed
           increments (of S) with chi-squared distributed increments (of v ), we
           will in the following only consider Euler schemes for both the S and v
           process.
           This has the advantage that the increments of v become normally
           distributed as well and can therefore be easily correlated with the
           increments of S.
                                             Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE            to Monte Carlo in Finance
                                                       FINANCE)                     Bologna - May 3-4, 2018 80 / 84

         Valuation of European Option with Stochastic Volatility  The Heston Model
   The Heston Model
           we consider two discretization schemes for S and seven discretization
           schemes for v .
           For S we have the simple Euler discretization scheme (with
           s = t - <U+2206>t)
                                                                      v       v    
                                           St = Ss e r <U+2206>t + vt <U+2206>tzt1
           As an alternative we consider the exact log Euler scheme
                                                                             v v
                                                            (r -vt /2)<U+2206>t+ vt <U+2206>tzt1
                                            St = Ss e
           This one is obtained by considering the dynamics of log St and
           applying Ito’s lemma to it.
                                             Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE            to Monte Carlo in Finance
                                                       FINANCE)                     Bologna - May 3-4, 2018 81 / 84

         Valuation of European Option with Stochastic Volatility The Heston Model
   The Heston Model
           These schemes can be combined with any of the following Euler
           schemes for the square-root diffusion (x + = max[0, x]):
           Full Truncation
                                                                       p v
                          x~t = x~s + <U+03BA>(<U+03B8> - x~s+ )<U+2206>t + s x~s+ <U+2206>tzt , xt = x~t+
           Partial Truncation
                                                                      p v
                           x~t = x~s + <U+03BA>(<U+03B8> - x~s )<U+2206>t + s x~s+ <U+2206>tzt ,                      xt = x~t+
           Truncation
                                             h                                      p v           i
                              xt = max 0, x~s + <U+03BA>(<U+03B8> - x~s )<U+2206>t + s x~s <U+2206>tzt
           Reflection
                                                                        p v
                        x~t = |x~s | + <U+03BA>(<U+03B8> - |x~s |)<U+2206>t + s |x~s | <U+2206>tzt ,                    xt = |x~t |
                                             Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE            to Monte Carlo in Finance
                                                       FINANCE)                      Bologna - May 3-4, 2018 82 / 84

         Valuation of European Option with Stochastic Volatility The Heston Model
   The Heston Model
           Hingham-Mao
                                                                     p v
                           x~t = x~s + <U+03BA>(<U+03B8> - x~s )<U+2206>t + s |x~s | <U+2206>tzt ,                   xt = |x~t |
           Simple Reflection
                                                                                 p v
                                  x~t = x~s + <U+03BA>(<U+03B8> - x~s )<U+2206>t + s x~s <U+2206>tzt
           Absorption
                                                                        p v
                          x~t = x~s+ + <U+03BA>(<U+03B8> - x~s+ )<U+2206>t + s x~s+ <U+2206>tzt ,                     xt = x~t+
           In the literature there are a lot of tests and numerical studies
           available that compare efficiency and precision of different
           discretization schemes.
                                             Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE            to Monte Carlo in Finance
                                                       FINANCE)                     Bologna - May 3-4, 2018 83 / 84

         Valuation of European Option with Stochastic Volatility The Heston Model
   Notebook
                                                                        GitHub : polyhedron-gdl;
                                                                        Notebook : n07 mcs heston;
                                             Introduction
Giovanni Della Lunga (WORKSHOP IN QUANTITATIVE            to Monte Carlo in Finance
                                                       FINANCE)                     Bologna - May 3-4, 2018 84 / 84

